# Campaign Performance Analysis Using SQL

## Project Overview

This project demonstrates an advanced SQL-based approach to analyzing digital marketing campaign data, focusing on the integration and manipulation of data from multiple sources. Specifically, the project covers data from Facebook and Google Ads campaigns, showcasing how to efficiently manage, transform, and analyze key performance indicators (KPIs) for marketing efforts.

## Task Description

The task required creating a SQL query to perform the following:

1. **Data Integration**: Combine data from four different tables—`facebook_ads_basic_daily`, `facebook_adset`, `facebook_campaign`, and `google_ads_basic_daily`—to create a comprehensive dataset that includes metrics such as spend, impressions, reach, clicks, leads, and value for each day and each campaign. Missing values (NULL) were handled by replacing them with zeros.

2. **Campaign Parameter Extraction**: Extract the `utm_campaign` parameter from the `url_parameters` string in the combined data. The parameter values were converted to lowercase, with special handling to convert 'nan' values to NULL.

3. **KPI Calculation**: Calculate essential KPIs, including:
   - **Total Spend**: The total amount spent on ads for each campaign per day.
   - **Total Impressions**: The number of times ads were displayed.
   - **Total Clicks**: The number of times ads were clicked.
   - **Total Value**: The total conversion value generated by the ads.
   - **CTR (Click-Through Rate)**: The ratio of clicks to impressions, expressed as a percentage.
   - **CPC (Cost Per Click)**: The average cost of each click.
   - **CPM (Cost Per Mille)**: The cost per thousand impressions.
   - **ROMI (Return on Marketing Investment)**: The ratio of revenue to spend.

## SQL Solution

The SQL solution is divided into two main parts:

1. **CTE (Common Table Expression)**:
   - Merges data from the four tables.
   - Replaces NULL values with 0 for numerical fields.
2. **Final Query**:
   - Extracts the required fields and performs necessary calculations.
   - Uses conditional logic to handle special cases, such as avoiding division by zero.

### SQL Code

```sql
WITH CTE AS (
    SELECT
        facebook_ads_basic_daily.ad_date,
        facebook_ads_basic_daily.url_parameters,
        COALESCE(facebook_ads_basic_daily.spend, 0) AS spend,
        COALESCE(facebook_ads_basic_daily.impressions, 0) AS impressions,
        COALESCE(facebook_ads_basic_daily.reach, 0) AS reach,
        COALESCE(facebook_ads_basic_daily.clicks, 0) AS clicks,
        COALESCE(facebook_ads_basic_daily.leads, 0) AS leads,
        COALESCE(facebook_ads_basic_daily.value, 0) AS value
    FROM
        facebook_ads_basic_daily
    JOIN
        facebook_adset ON facebook_ads_basic_daily.adset_id = facebook_adset.adset_id
    JOIN
        facebook_campaign ON facebook_ads_basic_daily.campaign_id = facebook_campaign.campaign_id
    JOIN
        google_ads_basic_daily ON facebook_campaign.campaign_name = google_ads_basic_daily.campaign_name
)
SELECT
    ad_date,
    CASE
    	WHEN LOWER(SUBSTRING(url_parameters FROM 'utm_campaign=([^&]*)')) = 'nan' THEN NULL
    	ELSE LOWER(SUBSTRING(url_parameters FROM 'utm_campaign=([^&]*)'))
	END AS utm_campaign,
    SUM(spend) AS total_spend,
    SUM(impressions) AS total_impressions,
    SUM(clicks) AS total_clicks,
    SUM(value) AS total_value,
    CASE
        WHEN SUM(impressions) = 0 THEN 0
        ELSE round(1.0 * SUM(clicks) / SUM(impressions), 2) * 100
    END AS CTR,
    CASE
        WHEN SUM(clicks) = 0 THEN 0
        ELSE round(1.0 * SUM(spend) / SUM(clicks), 2)
    END AS CPC,
    CASE
        WHEN SUM(impressions) = 0 THEN 0
        ELSE round(1.0 * SUM(spend) / SUM(impressions), 2) * 1000
    END AS CPM,
    CASE
        WHEN SUM(spend) = 0 THEN 0
        ELSE round(1.0 * SUM(value) / SUM(spend), 2)
    END AS ROMI
FROM
    CTE
GROUP BY
    ad_date, utm_campaign;
```

## Key Features

- **Data Cleansing**: Handles NULL values and inconsistent data (e.g., 'nan' strings) effectively.
- **Scalability**: The approach used in this project can easily be extended to accommodate more complex datasets and additional KPIs.
- **Performance Optimization**: The use of `COALESCE`, `CASE`, and careful groupings ensures that the query performs efficiently even on larger datasets.

## Usage

To replicate the analysis:

1. Ensure you have access to the necessary tables (`facebook_ads_basic_daily`, `facebook_adset`, `facebook_campaign`, and `google_ads_basic_daily`).
2. Run the SQL code in your SQL environment.
3. Review the output, which will provide the KPIs for each campaign on each day.

## Conclusion

This project provides a solid foundation for analyzing marketing data using SQL, demonstrating advanced techniques in data manipulation, string handling, and conditional logic. The resulting analysis gives valuable insights into the performance of marketing campaigns across different platforms.
